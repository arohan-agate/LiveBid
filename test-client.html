<!DOCTYPE html>
<html>
<head>
    <title>LiveBid Monitor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .box { border: 1px solid #ccc; padding: 10px; margin-bottom: 20px; border-radius: 5px; }
        #messages { height: 300px; overflow-y: scroll; background: #f0f0f0; border: 1px solid #999; padding: 10px; }
        .update { color: green; font-weight: bold; }
    </style>
</head>
<body>
    <h1>LiveBid Real-Time Monitor</h1>
    
    <div class="box">
        <h3>Connection</h3>
        <input type="text" id="auctionId" placeholder="Enter Auction ID" style="width: 300px;">
        <button onclick="connect()">Connect</button>
        <button onclick="disconnect()" disabled id="disconnectBtn">Disconnect</button>
        <div id="status">Status: Disconnected</div>
    </div>

    <div class="box">
        <h3>Live Updates</h3>
        <div id="messages"></div>
    </div>

    <script>
        var stompClient = null;

        function connect() {
            var auctionId = document.getElementById('auctionId').value;
            if (!auctionId) {
                alert("Please enter an Auction ID");
                return;
            }

            var socket = new SockJS('http://localhost:8080/ws');
            stompClient = Stomp.over(socket);

            stompClient.connect({}, function (frame) {
                setConnected(true);
                log("Connected: " + frame);
                
                // Subscribe to the specific auction topic
                stompClient.subscribe('/topic/auctions/' + auctionId, function (message) {
                    showUpdate(JSON.parse(message.body));
                });
            }, function(error) {
                log("Error: " + error);
            });
        }

        function disconnect() {
            if (stompClient !== null) {
                stompClient.disconnect();
            }
            setConnected(false);
            log("Disconnected");
        }

        function setConnected(connected) {
            document.getElementById('disconnectBtn').disabled = !connected;
            document.getElementById('status').innerHTML = "Status: " + (connected ? "<span style='color:green'>Connected</span>" : "<span style='color:red'>Disconnected</span>");
        }

        function showUpdate(data) {
            var html = "<div class='update'>[" + new Date().toLocaleTimeString() + "] " +
                       "New Bid! Price: $" + (data.newPrice/100).toFixed(2) + 
                       " (Leader: " + data.newLeaderId + ")</div>";
            document.getElementById('messages').innerHTML = html + document.getElementById('messages').innerHTML;
        }

        function log(message) {
            var div = document.createElement('div');
            div.innerText = "[" + new Date().toLocaleTimeString() + "] " + message;
            document.getElementById('messages').prepend(div);
        }
    </script>
</body>
</html>
